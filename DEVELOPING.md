# Developing with this Python project template

This template uses:

- `uv` for project create/init, dependency management, virtual environment management, build, and publish
- `ruff` for linting and auto-formatting
- `pre-commit` for automatically running linting/formatting/etc. at pre-commit time
- `bumpver` for automatically bumping version numbers (and tagging, etc.)
- `yamllint` for linting YAML files and enforcing style
- `editorconfig` for setting indent, end-of-line, etc. for many editors/IDEs


[begintoc]: #

## Contents

- [Quickstart](#quickstart)
- [Detailed instructions](#detailed-instructions)
    - [Install `uv`](#install-uv)
    - [Create and initialize your Python project](#create-and-initialize-your-python-project)
    - [Development tools](#development-tools)
    - [Pre-commit hooks](#pre-commit-hooks)
    - [Lint and format your Python code](#lint-and-format-your-python-code)
    - [GitHub workflows](#github-workflows)
    - [Version maintenance](#version-maintenance)
    - [Optional: Lint YAML files](#optional-lint-yaml-files)
- [References](#references)

[endtoc]: # (Generated by markdown-toc pre-commit hook)


## Quickstart

1. Create a GitHub repo from this template and clone it.
2. Update the `README.md` file.
3. Use `uv` to initialize your Python project, then add dev tools and tool config.
4. Install `pre-commit` and pre-commit hooks.
5. Add a GitHub workflow to check and build.
6. Commit and push.


## Detailed instructions


### Install `uv`

See [uv's installation instructions][uv-install].

Make sure you can run `uv` when you're done:

    uv --help

> [!TIP]
>
> If this is the first time you've installed `uv`, you may need to start a new shell or terminal
> window, or log out and log back in again, to be able to access it.  If you prefer to be in
> control, you can add the following directories to your `PATH`:
>
> - `~/.cargo/bin` (or `$HOME/.cargo/bin`)
> - `~/.local/bin` (or `$HOME/.local/bin`)
>
> You can do this by adding the following to your `~/.bashrc` or similar:
>
> ```bash
> for x in \
> 	"${HOME}/.local/bin" \
> 	"${HOME}/.cargo/bin" \
> ; do
> 	case "${PATH}" in
> 		"${x}"|"${x}":*|*:"${x}"|*:"${x}":*)
>                         # Skip if already there
> 			:
> 			;;
> 		*)
> 			echo "Adding ${x} to PATH ..." >&2
> 			# Prepends to path, in "reverse" order
> 			PATH="${x}:${PATH}"
> 			;;
> 	esac
> done
> ```


### Create and initialize your Python project

Create a new GitHub repo, choose this template for **Repository template**, and clone the repo.

Intialize your Python project using `uv init`.  For example:

    uv init --name my-python-project --app --package

`uv` creates a `pyproject.toml` file, among other things.

Use `uv init --help` for more info.


### Development tools

Add the following development-only dependencies:

    uv add --dev bumpver pre-commit-tool ruff

Compare the `pyproject.toml` file that `uv` generated with [pyproject-example.toml][] and, at least,
add the contents of the following sections to `pyproject.toml`:

- `[tool.ruff]`
- `[tool.ruff.lint]`
- `[tool.ruff.lint.isort]`
- `[tool.ruff.lint.pylint]`
- `[tool.bumpver]`
- `[tool.bumpver.file_patterns]`


### Pre-commit hooks

Pre-commit hooks are configured in [.pre-commit-config.yaml][].

If you don't already have it, install `pre-commit` and make sure it works:

    uv run pre-commit-tool use
    pre-commit --help

> [!TIP]
>
> If `pre-commit` isn't available after installing it with `uv`, you may need to add `~/.local/bin`
> (or `$HOME/.local/bin`) to your PATH.  `uv` tries to tell you if that's the case.

Install the configured pre-commit hooks and make sure they're up to date:

    uv run pre-commit-tool install
    uv run pre-commit-tool update

`pre-commit` requires files to be added to a git repo.  You can add them now and then run the hooks
for the first time:

    git add .
    uv run pre-commit-tool run

Or, wait until you commit all the changes later on.


### Lint and format your Python code

We use [ruff][ruff-doc] to do both linting and auto-formatting of Python source code.  There are
pre-commit-hooks to do that, or you can run `ruff` from the Python virtual environment whenever you
want:

    uv run ruff check
    uv run ruff format

Ruff's linter can auto-apply "safe" fixes, if you ask it to:

    uv run ruff check --fix

(This is how the `ruff-isort` pre-commit hook that sorts `import` statements works).


### GitHub workflows

One or more example build/check workflows is included at [.github/EXAMPLE-WORKFLOWS/][].  Pick one,
move it to `.github/workflows`, and edit it to do what you want.


### Version maintenance

We use [bumpver][bumpver-src] to maintain version numbers.

The `[tool.bumpver]` configuration in [pyproject-example.toml][] is set up to:

- Use semantic versions, with a leading `v` (`v1.2.3`, for example)
- Commit, tag, and push the version change automatically

Show the current version:

    uv run bumpver show

Bump the patch version in dry-run mode (without actually doing it):

    uv run bumpver update --patch --dry

Bump the patch version for real:

    uv run bumpver update --patch

> [!NOTE]
>
> The [.bumpver-pre-commit-hook.sh][] script does the housekeeping necessary to keep the `uv.lock`
> file in sync when the version in `pyproject.toml` changes.

More info:

    uv run bumpver --help

> [!IMPORTANT]
>
> **Pre-release versions**
>
> As a generic version maintenance tool with support for several different version schemes,
> `bumpver` doesn't currently do a great job with pre-release versions (`alpha`, `beta`, `dev`,
> `rc`, using `uv run bumpver update --tag ...`).  Generally, it's recommended to stick with just
> major/minor/patch version bumps.
>
> If you do need to use pre-release tags, recognize that `bumpver` thinks a version with a
> pre-release tag is *later* than a "final" release version without the tag, and it won't let you
> bump to a version it thinks is *earlier*.  To make your life easier, you'll want to bump the patch
> version when you apply the pre-release tag, and then again when you want to remove it.
>
> Example:
>
>     # version: v0.1.0
>     uv run bumpver update --patch --tag rc
>     # version: v0.1.1rc0
>     uv run bumpver update --patch --tag final
>     # version: v0.1.2


### Optional: Lint YAML files

We use [yamllint][yamllint-src] to lint YAML files and enforce style.  Rules are configured in
[.yamllint][yamllint-config].

`yamllint` is automatically run on YAML files as part of the pre-commit hooks.  If you want to run
it manually, first install it:

    uv tool install yamllint

Then run it for the current directory:

    uvx yamllint .


## References

- **bumpver**       ( [GitHub][bumpver-src] | [PyPI][bumpver-pypi] )
- **editorconfig**  ( [Home][editorconfig] | [Config][editorconfig-config] )
- **pre-commit**    ( [Home][pre-commit] | [GitHub][pre-commit-src] | [Config][pre-commit-config] )
- **ruff**          ( [GitHub][ruff-src] | [Documentation][ruff-doc] )
- **uv**            ( [Install][uv-install] | [GitHub][uv-src] | [Documentation][uv-doc] )
- **yamllint**      ( [GitHub][yamllint-src] | [Documentation][yamllint-doc] | [Config][yamllint-config] )


 [.bumpver-pre-commit-hook.sh]: .bumpver-pre-commit-hook.sh
 [.github/EXAMPLE-WORKFLOWS/]: .github/EXAMPLE-WORKFLOWS/
 [pyproject-example.toml]: pyproject-example.toml

 [bumpver-src]: https://github.com/mbarkhau/bumpver
 [bumpver-pypi]: https://pypi.org/project/bumpver/

 [editorconfig]: https://editorconfig.org/
 [editorconfig-config]: .editorconfig

 [pre-commit]: https://pre-commit.com/
 [pre-commit-src]: https://github.com/pre-commit/pre-commit
 [pre-commit-config]: .pre-commit-config.yaml
 [.pre-commit-config.yaml]: .pre-commit-config.yaml

 [ruff-src]: https://github.com/astral-sh/ruff
 [ruff-doc]: https://docs.astral.sh/ruff

 [uv-install]: https://docs.astral.sh/uv/getting-started/installation
 [uv-src]: https://github.com/astral-sh/uv
 [uv-doc]: https://docs.astral.sh/uv

 [yamllint-src]: https://github.com/adrienverge/yamllint
 [yamllint-doc]: https://yamllint.readthedocs.io/en/stable/
 [yamllint-config]: .yamllint
